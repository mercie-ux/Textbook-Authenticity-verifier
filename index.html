<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Textbook Authenticity Verifier</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Mock blockchain verification API (simulated)
    const mockBlockchainAPI = {
      verifyTextbook: async (qrCode) => {
        // Mock database of valid QR codes
        const validQRCodes = {
          "TEXTBOOK123": { title: "Mathematics Grade 10", publisher: "Kenya Publishers", status: "Authentic" },
          "TEXTBOOK456": { title: "Science Grade 12", publisher: "Nairobi Books", status: "Authentic" },
        };
        await new Promise((resolve) => setTimeout(resolve, 1000)); // Simulate network delay
        return validQRCodes[qrCode] || { status: "Counterfeit", message: "Invalid QR code" };
      },
      reportCounterfeit: async (qrCode, details) => {
        await new Promise((resolve) => setTimeout(resolve, 1000)); // Simulate network delay
        return { success: true, message: "Report submitted successfully" };
      },
    };

    // Main App Component
    const App = () => {
      const [qrScannerActive, setQrScannerActive] = useState(false);
      const [verificationResult, setVerificationResult] = useState(null);
      const [reportForm, setReportForm] = useState({ qrCode: "", details: "" });
      const [reportStatus, setReportStatus] = useState(null);

      // Initialize QR code scanner
      useEffect(() => {
        if (qrScannerActive) {
          const html5QrCode = new Html5Qrcode("qr-reader");
          html5QrCode
            .start(
              { facingMode: "environment" },
              { fps: 10, qrbox: { width: 250, height: 250 } },
              async (decodedText) => {
                // Verify QR code
                const result = await mockBlockchainAPI.verifyTextbook(decodedText);
                setVerificationResult(result);
                setQrScannerActive(false);
                html5QrCode.stop();
              },
              (error) => console.log("QR scan error:", error)
            )
            .catch((err) => console.log("QR scanner start error:", err));
          return () => html5QrCode.stop().catch((err) => console.log("QR scanner stop error:", err));
        }
      }, [qrScannerActive]);

      // Handle report submission
      const handleReportSubmit = async (e) => {
        e.preventDefault();
        const result = await mockBlockchainAPI.reportCounterfeit(reportForm.qrCode, reportForm.details);
        setReportStatus(result);
        setReportForm({ qrCode: "", details: "" });
      };

      return (
        <div className="min-h-screen bg-gray-100 flex flex-col items-center p-4">
          <h1 className="text-2xl font-bold text-blue-600 mb-4">Textbook Authenticity Verifier</h1>

          {/* QR Code Scanner Section */}
          <div className="w-full max-w-md bg-white p-6 rounded-lg shadow-md mb-4">
            <h2 className="text-lg font-semibold mb-2">Scan QR Code</h2>
            {!qrScannerActive ? (
              <button
                onClick={() => setQrScannerActive(true)}
                className="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600"
              >
                Start QR Scanner
              </button>
            ) : (
              <div id="qr-reader" className="w-full h-64"></div>
            )}
            {verificationResult && (
              <div className="mt-4 p-4 rounded bg-gray-100">
                <p className="font-semibold">
                  Status: <span className={verificationResult.status === "Authentic" ? "text-green-600" : "text-red-600"}>{verificationResult.status}</span>
                </p>
                {verificationResult.title && <p>Title: {verificationResult.title}</p>}
                {verificationResult.publisher && <p>Publisher: {verificationResult.publisher}</p>}
                {verificationResult.message && <p>Message: {verificationResult.message}</p>}
              </div>
            )}
          </div>

          {/* Report Counterfeit Section */}
          <div className="w-full max-w-md bg-white p-6 rounded-lg shadow-md">
            <h2 className="text-lg font-semibold mb-2">Report Counterfeit Textbook</h2>
            <form onSubmit={handleReportSubmit} className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">QR Code (if known)</label>
                <input
                  type="text"
                  value={reportForm.qrCode}
                  onChange={(e) => setReportForm({ ...reportForm, qrCode: e.target.value })}
                  className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="Enter QR code"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">Details</label>
                <textarea
                  value={reportForm.details}
                  onChange={(e) => setReportForm({ ...reportForm, details: e.target.value })}
                  className="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="Describe the issue"
                  rows="4"
                ></textarea>
              </div>
              <button
                type="submit"
                className="w-full bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600"
              >
                Submit Report
              </button>
            </form>
            {reportStatus && (
              <div className="mt-4 p-4 rounded bg-gray-100">
                <p className={reportStatus.success ? "text-green-600" : "text-red-600"}>{reportStatus.message}</p>
              </div>
            )}
          </div>
        </div>
      );
    };

    // Render the App
    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>